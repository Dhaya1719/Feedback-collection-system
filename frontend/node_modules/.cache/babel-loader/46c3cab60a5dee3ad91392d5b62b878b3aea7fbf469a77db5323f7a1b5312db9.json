{"ast":null,"code":"import React,{useState,useEffect}from'react';import axios from'axios';import{Chart as ChartJS,CategoryScale,LinearScale,BarElement,ArcElement,Title,Tooltip,Legend}from'chart.js';import{Bar,Pie}from'react-chartjs-2';// Register Chart.js components\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";ChartJS.register(CategoryScale,LinearScale,BarElement,ArcElement,Title,Tooltip,Legend);function FormAnalytics(_ref){var _analyticsData$Object;let{formId}=_ref;const[analyticsData,setAnalyticsData]=useState(null);const[formTitle,setFormTitle]=useState('');const[loading,setLoading]=useState(true);useEffect(()=>{const fetchAnalytics=async()=>{setLoading(true);try{const token=localStorage.getItem('token');const res=await axios.get(\"http://localhost:5000/api/submissions/analytics/\".concat(formId),{headers:{'x-auth-token':token}});setAnalyticsData(res.data.analytics);setFormTitle(res.data.formTitle);}catch(err){console.error(\"Error fetching analytics:\",err.response.data);}finally{setLoading(false);}};fetchAnalytics();},[formId]);if(loading)return/*#__PURE__*/_jsx(\"div\",{className:\"analytics-section\",children:\"Loading analytics...\"});if(!analyticsData)return/*#__PURE__*/_jsx(\"div\",{className:\"analytics-section\",children:\"Error loading analytics.\"});const totalSubmissions=((_analyticsData$Object=analyticsData[Object.keys(analyticsData)[0]])===null||_analyticsData$Object===void 0?void 0:_analyticsData$Object.totalResponses)||0;const generateChartData=(type,data)=>{const labels=type==='rating'?['1 Star','2 Stars','3 Stars','4 Stars','5 Stars']:Object.keys(data.counts);const chartData=type==='rating'?Object.values(data.distribution):Object.values(data.counts);return{labels:labels,datasets:[{label:type==='rating'?'Rating Distribution':'Response Count',data:chartData,backgroundColor:['#ff6384','#36a2eb','#cc65fe','#ffce56','#4bc0c0','#ff9f40','#9966ff','#ffcd56','#c9cbcf','#a3e4d7']}]};};return/*#__PURE__*/_jsxs(\"div\",{className:\"analytics-section\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"Analytics for \\\"\",formTitle,\"\\\"\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"summary-stat\",children:[\"Total Submissions: \",/*#__PURE__*/_jsx(\"strong\",{children:totalSubmissions})]}),Object.keys(analyticsData).map(key=>{const q=analyticsData[key];const isChartable=q.questionType==='rating'||q.questionType==='radio'||q.questionType==='checkbox';return/*#__PURE__*/_jsxs(\"div\",{className:\"question-analysis-card\",children:[/*#__PURE__*/_jsx(\"h4\",{children:q.questionText}),q.questionType==='rating'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"summary-stat\",children:[\"Average Rating: \",/*#__PURE__*/_jsxs(\"strong\",{children:[q.data.average,\" / 5\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"chart-container\",children:/*#__PURE__*/_jsx(Bar,{data:generateChartData('rating',q.data)})})]}),(q.questionType==='radio'||q.questionType==='checkbox')&&/*#__PURE__*/_jsx(\"div\",{className:\"chart-container-half\",children:/*#__PURE__*/_jsx(Pie,{data:generateChartData(q.questionType,q.data)})}),q.questionType==='text'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"summary-stat\",children:[\"Total Comments: \",/*#__PURE__*/_jsx(\"strong\",{children:q.data.comments.length})]}),/*#__PURE__*/_jsx(\"div\",{className:\"comments-list\",children:q.data.comments.length>0?q.data.comments.map((comment,i)=>/*#__PURE__*/_jsxs(\"p\",{className:\"comment-item\",children:[\"\\\"\",comment,\"\\\"\"]},i)):/*#__PURE__*/_jsx(\"p\",{children:\"No text responses recorded.\"})})]}),/*#__PURE__*/_jsx(\"hr\",{})]},key);})]});}export default FormAnalytics;","map":{"version":3,"names":["React","useState","useEffect","axios","Chart","ChartJS","CategoryScale","LinearScale","BarElement","ArcElement","Title","Tooltip","Legend","Bar","Pie","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","register","FormAnalytics","_ref","_analyticsData$Object","formId","analyticsData","setAnalyticsData","formTitle","setFormTitle","loading","setLoading","fetchAnalytics","token","localStorage","getItem","res","get","concat","headers","data","analytics","err","console","error","response","className","children","totalSubmissions","Object","keys","totalResponses","generateChartData","type","labels","counts","chartData","values","distribution","datasets","label","backgroundColor","map","key","q","isChartable","questionType","questionText","average","comments","length","comment","i"],"sources":["E:/murugesan/Downloads/nm pro/Feedback-collection-system/frontend/src/components/FormAnalytics.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport { Chart as ChartJS, CategoryScale, LinearScale, BarElement, ArcElement, Title, Tooltip, Legend } from 'chart.js';\r\nimport { Bar, Pie } from 'react-chartjs-2';\r\n\r\n// Register Chart.js components\r\nChartJS.register(CategoryScale, LinearScale, BarElement, ArcElement, Title, Tooltip, Legend);\r\n\r\nfunction FormAnalytics({ formId }) {\r\n  const [analyticsData, setAnalyticsData] = useState(null);\r\n  const [formTitle, setFormTitle] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const fetchAnalytics = async () => {\r\n      setLoading(true);\r\n      try {\r\n        const token = localStorage.getItem('token');\r\n        const res = await axios.get(`http://localhost:5000/api/submissions/analytics/${formId}`, {\r\n          headers: { 'x-auth-token': token }\r\n        });\r\n        setAnalyticsData(res.data.analytics);\r\n        setFormTitle(res.data.formTitle);\r\n      } catch (err) {\r\n        console.error(\"Error fetching analytics:\", err.response.data);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchAnalytics();\r\n  }, [formId]);\r\n\r\n  if (loading) return <div className=\"analytics-section\">Loading analytics...</div>;\r\n  if (!analyticsData) return <div className=\"analytics-section\">Error loading analytics.</div>;\r\n\r\n  const totalSubmissions = analyticsData[Object.keys(analyticsData)[0]]?.totalResponses || 0;\r\n\r\n  const generateChartData = (type, data) => {\r\n    const labels = type === 'rating' ? ['1 Star', '2 Stars', '3 Stars', '4 Stars', '5 Stars'] : Object.keys(data.counts);\r\n    const chartData = type === 'rating' ? Object.values(data.distribution) : Object.values(data.counts);\r\n    \r\n    return {\r\n      labels: labels,\r\n      datasets: [\r\n        {\r\n          label: type === 'rating' ? 'Rating Distribution' : 'Response Count',\r\n          data: chartData,\r\n          backgroundColor: [\r\n              '#ff6384', '#36a2eb', '#cc65fe', '#ffce56', '#4bc0c0', \r\n              '#ff9f40', '#9966ff', '#ffcd56', '#c9cbcf', '#a3e4d7'\r\n          ],\r\n        },\r\n      ],\r\n    };\r\n  };\r\n\r\n  return (\r\n    <div className=\"analytics-section\">\r\n      <h3>Analytics for \"{formTitle}\"</h3>\r\n      <p className=\"summary-stat\">Total Submissions: <strong>{totalSubmissions}</strong></p>\r\n\r\n      {Object.keys(analyticsData).map(key => {\r\n        const q = analyticsData[key];\r\n        const isChartable = q.questionType === 'rating' || q.questionType === 'radio' || q.questionType === 'checkbox';\r\n\r\n        return (\r\n          <div key={key} className=\"question-analysis-card\">\r\n            <h4>{q.questionText}</h4>\r\n\r\n            {q.questionType === 'rating' && (\r\n              <>\r\n                <p className=\"summary-stat\">Average Rating: <strong>{q.data.average} / 5</strong></p>\r\n                <div className=\"chart-container\"><Bar data={generateChartData('rating', q.data)} /></div>\r\n              </>\r\n            )}\r\n            \r\n            {(q.questionType === 'radio' || q.questionType === 'checkbox') && (\r\n              <div className=\"chart-container-half\">\r\n                <Pie data={generateChartData(q.questionType, q.data)} />\r\n              </div>\r\n            )}\r\n            \r\n            {q.questionType === 'text' && (\r\n              <>\r\n                <p className=\"summary-stat\">Total Comments: <strong>{q.data.comments.length}</strong></p>\r\n                <div className=\"comments-list\">\r\n                  {q.data.comments.length > 0 ? (\r\n                    q.data.comments.map((comment, i) => <p key={i} className=\"comment-item\">\"{comment}\"</p>)\r\n                  ) : (\r\n                    <p>No text responses recorded.</p>\r\n                  )}\r\n                </div>\r\n              </>\r\n            )}\r\n            <hr />\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default FormAnalytics;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}